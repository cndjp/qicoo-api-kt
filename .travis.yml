language: java
jdk:
- openjdk11
sudo: required
services:
- docker
- mysql
- redis-server
env:
  global:
  - MYSQL_USER="root"
  - MYSQL_HOST="127.0.0.1"
  - MYSQL_DB="qicoo2db"
  - MYSQL_PORT="3306"
  - REDIS_HOST="localhost"
  - REDIS_PORT="6379"
  - DOCKER_REPO='cndjp/qicoo-api-kt'
  - secure: DgvqVhStXdMen5pNbG6OUgVpyKKdFJfY6dWYQ1kbjKtYCD8nyxICbO9oAUR4uMNnEyGDsyzP1Jd5+RwvEdSCI0/vgdl0cDsqfTtafiUvSs3193/UbjaQdLYSnZT5M+20iNJ/1VUOU8DQDwN/6i0vZXOL66zo/maxGNIanFW/wlurAG2JpYUVQHHzR+6XnypeSyvjen7avpSAWWBr1OvCfl9wv2aiE33pFV6H9q6I4282Y3blDsMGpQfgAH0QNY0+aNeb6Oz/JWiezHCaLj5kcAHg1Hr2cEUg6vQhatqznTR2ZrfTJvcsjZQId6uVdpaYWt0+zbOlu6eLChWEYAueb/YmP3S2HZVExNseR1QkGUqOZb77qAWvCkrAcETa3FgZ+9v+Iq7RTMnfs015rpriWpjOD4Oo/IUofP5i/361m3baPMNdr2mzSmSZOEI7l3gwTQGPrP8nRfMA11BPblUczMpAAF5l2WB0anYrOAQnGB0Fe1wTII7hzI6Ye/5IBBQyWc46eU+AvzKq8wiq9nQ5BghtSF9KAmWdd2U69HER2KcjyweAIKEU9qUGffjom39figwWJu4NJphUPlq4ZHEVXsysljyp+GxHYEIGTD9JJBBfZpse/DvNx7ckqdDpnsiewj8ODyrNP/TGBqyovXXl5WCmIM/0CZf0H74YvfaPt7E=
before_install:
- export TZ=Asia/Tokyo
- curl -s api.sdkman.io | bash
- source /home/travis/.sdkman/bin/sdkman-init.sh
- sdk list gradle
- sdk install gradle 5.6.2
- sdk default gradle 5.6.2
before_script:
- echo ${DOCKERHUB_PASSWORD} | docker login -u cndjpintegrate --password-stdin
- echo 'Asia/Tokyo' | sudo tee /etc/timezone
- sudo dpkg-reconfigure --frontend noninteractive tzdata
- date
- mkdir /opt/bin
- curl -LSfs https://japaric.github.io/trust/install.sh | sh -s -- --git casey/just
  --target x86_64-unknown-linux-musl --to /opt/bin/
- export PATH=/opt/bin:$PATH
- just version
- mysql_tzinfo_to_sql /usr/share/zoneinfo | mysql -u root mysql
- echo "CREATE DATABASE IF NOT EXISTS ${MYSQL_DB}" | mysql -h${MYSQL_HOST} -uroot
- echo 'set global time_zone = "Asia/Tokyo"' | mysql -h${MYSQL_HOST} -uroot
script:
- just test
- just build
- just docker-release
before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  bundler: true
  directories:
  - "${HOME}/.gradle/caches/"
  - "${HOME}/.gradle/wrapper/"
  - "${HOME}/.android/build-cache"
